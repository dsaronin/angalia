%i.center &diams;&ensp;livestream&ensp;&diams;
.webcam-container
  %img#webcam-stream{alt: "Angalia livestream"}
  :javascript
    // Pass the server-side @is_livestream state to JavaScript
    const isLivestreamActive = #{!!@is_livestream}; // Converts Ruby boolean to JavaScript boolean
    const webcamImage = document.getElementById('webcam-stream');

    document.addEventListener('DOMContentLoaded', function() {
      if (isLivestreamActive) {
        webcamImage.src = "/webcam_stream";
        // Setup onerror for the live stream
        webcamImage.onerror = function() {
          console.error("Failed to load webcam stream. Switching to placeholder and retrying in 5 seconds...");
          webcamImage.src = "/images/in-progress-meeting.png"; // Placeholder
          setTimeout(() => {
            webcamImage.src = "/webcam_stream"; // Attempt reconnection
          }, 5000);
        };
      } else {
        webcamImage.src = "/images/lily-of-the-valley.png"; // Static image
        // Remove onerror if it was set for the stream, as it's not needed for a static image
        webcamImage.onerror = null;
      }
    });

%h5 Welcome to Angalia&trade;
%p Allowing authorized caregivers to video-meet with a patient.


